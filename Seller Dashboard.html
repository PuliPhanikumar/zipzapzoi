<!DOCTYPE html>
<html lang="en">
<head>
  <script>
  // --- AUTH CHECK ---
  (function() {
    const raw = localStorage.getItem('zzz_user');
    if (!raw) {
      window.location.href = 'Login Page.html';
    }
  })();
  </script>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ZipZapZoi - Seller Dashboard</title>

  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Spline+Sans:wght@400;500;600;700&display=swap" rel="stylesheet"/>
  <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet"/>

  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: { sans: ["Spline Sans", "sans-serif"] },
          colors: {
            "primary": "#019863",
            "secondary": "#4D96A9",
            "background-light": "#F7F9FC",
          },
          boxShadow: {
            "bouncy": "0 10px 20px -5px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05)",
          }
        }
      }
    }
  </script>
  <style>
    .material-symbols-outlined { font-variation-settings: 'FILL' 0, 'wght' 400, 'GRAD' 0, 'opsz' 24; }
    .nav-item.active { background: #E6F4F1; color: #019863; border-right: 3px solid #019863; }
    .fade-in { animation: fadeIn 0.4s ease-out; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
  </style>
</head>
<body class="bg-background-light h-screen flex overflow-hidden text-gray-800">

  <aside class="w-64 bg-white border-r border-gray-200 flex flex-col hidden md:flex z-20 shadow-xl">
    <div class="p-6 flex items-center gap-3 border-b border-gray-100">
      <span class="material-symbols-outlined text-primary text-3xl">all_inclusive</span>
      <div>
        <h1 class="font-bold text-xl tracking-tight text-gray-800">ZipZapZoi</h1>
        <p class="text-xs text-gray-500 uppercase tracking-wider">Seller Hub</p>
      </div>
    </div>

    <nav class="flex-1 p-4 space-y-1 overflow-y-auto">
      <a href="#" onclick="showSection('dashboard')" id="nav-dashboard" class="nav-item flex items-center gap-3 px-4 py-3 rounded-lg text-gray-600 hover:bg-gray-50 transition-all font-medium active">
        <span class="material-symbols-outlined">dashboard</span> Dashboard
      </a>
      <a href="#" onclick="showSection('listings')" id="nav-listings" class="nav-item flex items-center gap-3 px-4 py-3 rounded-lg text-gray-600 hover:bg-gray-50 transition-all font-medium">
        <span class="material-symbols-outlined">inventory_2</span> My Listings
      </a>
      <a href="Inbox.html" class="nav-item flex items-center gap-3 px-4 py-3 rounded-lg text-gray-600 hover:bg-gray-50 transition-all font-medium">
        <span class="material-symbols-outlined">chat</span> Messages
        <span id="navMsgBadge" class="ml-auto bg-red-500 text-white text-[10px] font-bold px-2 py-0.5 rounded-full hidden">0</span>
      </a>
      <a href="#" onclick="showSection('payouts')" id="nav-payouts" class="nav-item flex items-center gap-3 px-4 py-3 rounded-lg text-gray-600 hover:bg-gray-50 transition-all font-medium">
        <span class="material-symbols-outlined">payments</span> Payouts
      </a>
      <a href="#" onclick="showSection('settings')" id="nav-settings" class="nav-item flex items-center gap-3 px-4 py-3 rounded-lg text-gray-600 hover:bg-gray-50 transition-all font-medium">
        <span class="material-symbols-outlined">settings</span> Settings
      </a>
    </nav>

    <div class="p-4 border-t border-gray-200">
      <a href="classifieds.html" class="flex items-center gap-2 text-sm text-gray-500 hover:text-primary mb-4 px-2">
        <span class="material-symbols-outlined text-lg">arrow_back</span> Back to Site
      </a>
      <button onclick="handleLogout()" class="w-full flex items-center justify-center gap-2 bg-red-50 text-red-600 py-2.5 rounded-lg font-bold hover:bg-red-100 transition-colors">
        <span class="material-symbols-outlined text-lg">logout</span> Logout
      </button>
    </div>
  </aside>

  <main class="flex-1 flex flex-col h-full relative overflow-hidden">
    
    <header class="hidden md:flex items-center justify-between bg-white border-b border-gray-200 px-8 py-4">
      <h2 class="text-2xl font-bold text-gray-800" id="pageTitle">Dashboard</h2>
      <div class="flex items-center gap-6">
        <a href="Post Listing.html" class="flex items-center gap-2 bg-primary hover:bg-green-700 text-white px-5 py-2.5 rounded-full font-bold shadow-bouncy transition-transform hover:-translate-y-0.5">
          <span class="material-symbols-outlined text-lg">add_circle</span> Post New Ad
        </a>
        <div class="flex items-center gap-3 pl-6 border-l border-gray-200">
          <div class="w-10 h-10 rounded-full bg-primary/10 flex items-center justify-center text-primary font-bold text-lg" id="userInitial">U</div>
          <div>
            <p class="text-sm font-bold text-gray-800" id="userName">User</p>
            <p class="text-xs text-green-600 font-medium">Verified Seller</p>
          </div>
        </div>
      </div>
    </header>

    <div class="flex-1 overflow-y-auto p-6 md:p-8 scroll-smooth" id="mainArea">
      
      <section id="dashboard" class="space-y-8 fade-in">
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
          <div class="bg-gradient-to-br from-blue-500 to-blue-600 p-6 rounded-2xl shadow-lg text-white relative overflow-hidden group">
            <div class="absolute right-0 top-0 p-4 opacity-10 group-hover:opacity-20 transition-opacity"><span class="material-symbols-outlined text-6xl">visibility</span></div>
            <p class="text-blue-100 font-medium text-sm">Total Views</p>
            <p class="text-4xl font-bold mt-1">12.5K</p>
            <p class="text-xs bg-white/20 inline-block px-2 py-1 rounded mt-3 font-medium">↗ +12% this week</p>
          </div>
          <div class="bg-gradient-to-br from-primary to-green-600 p-6 rounded-2xl shadow-lg text-white relative overflow-hidden group">
            <div class="absolute right-0 top-0 p-4 opacity-10 group-hover:opacity-20 transition-opacity"><span class="material-symbols-outlined text-6xl">chat</span></div>
            <p class="text-green-100 font-medium text-sm">Active Chats</p>
            <p class="text-4xl font-bold mt-1" id="dashChatCount">0</p>
            <p class="text-xs bg-white/20 inline-block px-2 py-1 rounded mt-3 font-medium" id="dashUnreadText">0 New Messages</p>
          </div>
          <div class="bg-white p-6 rounded-2xl shadow-bouncy border border-gray-100 relative overflow-hidden group">
            <div class="absolute right-0 top-0 p-4 text-gray-100"><span class="material-symbols-outlined text-6xl">inventory_2</span></div>
            <p class="text-gray-500 font-medium text-sm">Live Listings</p>
            <p class="text-4xl font-bold text-gray-800 mt-1" id="liveCount">0</p>
            <a href="#" onclick="showSection('listings')" class="text-xs text-primary font-bold mt-3 inline-block hover:underline">Manage Listings →</a>
          </div>
          <div class="bg-white p-6 rounded-2xl shadow-bouncy border border-gray-100 relative overflow-hidden group">
            <div class="absolute right-0 top-0 p-4 text-gray-100"><span class="material-symbols-outlined text-6xl">star</span></div>
            <p class="text-gray-500 font-medium text-sm">Seller Rating</p>
            <div class="flex items-center gap-1 mt-1">
              <span class="text-4xl font-bold text-gray-800">4.8</span>
              <div class="text-yellow-400 flex text-sm"><span class="material-symbols-outlined fill">star</span></div>
            </div>
            <p class="text-xs text-gray-400 mt-3 font-medium">Based on 24 reviews</p>
          </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
          <div class="lg:col-span-2 bg-white p-6 rounded-2xl shadow-bouncy border border-gray-100">
            <div class="flex justify-between items-center mb-6">
              <h3 class="font-bold text-lg text-gray-800">Performance Analytics</h3>
              <select class="bg-gray-50 border-none text-sm rounded-lg py-1 px-3 font-medium text-gray-600 focus:ring-0 cursor-pointer">
                <option>Last 7 Days</option>
                <option>Last 30 Days</option>
              </select>
            </div>
            <div class="h-64 w-full">
              <canvas id="sellerChart"></canvas>
            </div>
          </div>

          <div class="bg-white p-6 rounded-2xl shadow-bouncy border border-gray-100 flex flex-col">
            <h3 class="font-bold text-lg text-gray-800 mb-4">Recent Messages</h3>
            <div class="flex-1 space-y-4 overflow-y-auto pr-2 custom-scroll" id="recentMsgList">
               </div>
            <a href="Inbox.html" class="mt-4 text-center text-sm font-bold text-primary hover:underline">View All Messages</a>
          </div>
        </div>
      </section>

      <section id="listings" class="hidden fade-in space-y-6">
        <div class="bg-white rounded-2xl shadow-bouncy border border-gray-100 overflow-hidden">
          <div class="p-6 border-b border-gray-100 flex justify-between items-center">
            <h3 class="font-bold text-lg text-gray-800">Your Listings</h3>
            <div class="flex gap-2">
              <input type="text" placeholder="Search..." class="bg-gray-50 border-none rounded-lg text-sm py-2 px-4 w-48 focus:ring-1 focus:ring-primary">
            </div>
          </div>
          
          <table class="w-full text-left">
            <thead class="bg-gray-50 border-b border-gray-100 text-xs uppercase text-gray-500 font-semibold">
              <tr>
                <th class="px-6 py-4">Item Details</th>
                <th class="px-6 py-4">Price</th>
                <th class="px-6 py-4">Status</th>
                <th class="px-6 py-4 text-center">Views</th>
                <th class="px-6 py-4 text-right">Actions</th>
              </tr>
            </thead>
            <tbody id="listingsTableBody" class="divide-y divide-gray-100 text-sm">
              </tbody>
          </table>
        </div>
      </section>

      <section id="payouts" class="hidden fade-in">
        <div class="bg-white p-10 rounded-2xl text-center border-2 border-dashed border-gray-300">
          <div class="w-16 h-16 bg-blue-50 text-blue-500 rounded-full flex items-center justify-center mx-auto mb-4">
            <span class="material-symbols-outlined text-3xl">account_balance</span>
          </div>
          <h3 class="text-xl font-bold text-gray-800">Payout Center</h3>
          <p class="text-gray-500 mt-2 max-w-md mx-auto">Connect your bank account to receive payments directly. Your current balance is <b>$0.00</b>.</p>
          <button class="mt-6 bg-primary text-white px-6 py-2.5 rounded-full font-bold shadow hover:bg-green-700 transition-colors">Setup Payouts</button>
        </div>
      </section>

      <section id="settings" class="hidden fade-in">
        <div class="bg-white p-8 rounded-2xl shadow-bouncy border border-gray-100 max-w-2xl">
          <h3 class="text-lg font-bold text-gray-800 mb-6 border-b pb-4">Profile Settings</h3>
          <form class="space-y-4">
            <div class="grid grid-cols-2 gap-4">
              <div>
                <label class="block text-sm font-medium mb-1">Full Name</label>
                <input type="text" id="settingName" class="w-full border-gray-300 rounded-lg focus:ring-primary">
              </div>
              <div>
                <label class="block text-sm font-medium mb-1">Email</label>
                <input type="email" id="settingEmail" disabled class="w-full bg-gray-50 border-gray-300 rounded-lg text-gray-500 cursor-not-allowed">
              </div>
            </div>
            <div>
              <label class="block text-sm font-medium mb-1">Phone</label>
              <input type="tel" value="+1 234 567 890" class="w-full border-gray-300 rounded-lg focus:ring-primary">
            </div>
            <div class="pt-4">
              <button class="bg-primary text-white px-6 py-2.5 rounded-lg font-bold shadow hover:bg-green-700 transition-colors">Save Changes</button>
            </div>
          </form>
        </div>
      </section>

    </div>
  </main>

  <script>
    // --- 1. USER & DATA LOGIC ---
    const user = JSON.parse(localStorage.getItem('zzz_user'));
    document.getElementById('userName').textContent = user ? user.name : 'Guest';
    document.getElementById('userInitial').textContent = user ? user.name.charAt(0) : 'G';
    document.getElementById('settingName').value = user ? user.name : '';
    document.getElementById('settingEmail').value = user ? user.email : '';

    // --- 2. MESSAGES LOGIC (Sync with Inbox) ---
    function updateMessageStats() {
      const msgs = JSON.parse(localStorage.getItem('zzz_messages') || '[]');
      
      // Calculate unread
      const unreadCount = msgs.filter(m => m.toUserId === user.id && !m.read).length;
      
      // Update Sidebar Badge
      const badge = document.getElementById('navMsgBadge');
      if(unreadCount > 0) {
        badge.textContent = unreadCount;
        badge.classList.remove('hidden');
      } else {
        badge.classList.add('hidden');
      }

      // Update Dashboard Card
      // Approx Active Chats: Unique listingIds involving me
      const myChats = [...new Set(msgs.filter(m => m.toUserId===user.id || m.fromUserId===user.id).map(m => m.listingId))];
      document.getElementById('dashChatCount').textContent = myChats.length;
      document.getElementById('dashUnreadText').textContent = `${unreadCount} New Messages`;

      // Recent List
      const recentList = document.getElementById('recentMsgList');
      // Show last 3 messages relevant to user
      const recent = msgs.filter(m => m.toUserId===user.id).slice(-3).reverse();
      
      if(recent.length === 0) {
        recentList.innerHTML = `<p class="text-xs text-gray-400 text-center">No recent messages.</p>`;
      } else {
        recentList.innerHTML = recent.map(m => `
          <a href="Inbox.html" class="flex items-start gap-3 p-3 rounded-xl hover:bg-gray-50 transition-colors group cursor-pointer border border-gray-100">
            <div class="w-10 h-10 rounded-full bg-purple-100 text-purple-600 flex items-center justify-center font-bold text-xs">${m.fromName.charAt(0)}</div>
            <div class="flex-1 min-w-0">
              <div class="flex justify-between items-baseline">
                <p class="font-bold text-sm text-gray-900">${m.fromName}</p>
                <span class="text-[10px] text-gray-400">Just now</span>
              </div>
              <p class="text-xs text-gray-500 truncate group-hover:text-primary transition-colors">${m.text}</p>
            </div>
          </a>
        `).join('');
      }
    }

    // --- 3. LISTINGS LOGIC ---
    function loadListings() {
      const allListings = JSON.parse(localStorage.getItem('zzz_listings') || '[]');
      // In a real app, filter by user ID. Here we show all "local" ones for demo.
      // const myListings = allListings.filter(l => l.userId === user.id); 
      const myListings = allListings; 

      document.getElementById('liveCount').textContent = myListings.length;
      const tbody = document.getElementById('listingsTableBody');
      
      if(myListings.length === 0) {
        tbody.innerHTML = `<tr><td colspan="5" class="p-8 text-center text-gray-400">No listings yet. <a href="Post Listing.html" class="text-primary hover:underline">Create one!</a></td></tr>`;
        return;
      }

      tbody.innerHTML = myListings.map(item => `
        <tr class="hover:bg-gray-50 group transition-colors">
          <td class="px-6 py-4">
            <div class="flex items-center gap-3">
              <div class="w-12 h-12 rounded-lg bg-gray-100 bg-cover bg-center border border-gray-200" style="background-image: url('${item.image || 'https://via.placeholder.com/150'}')"></div>
              <div>
                <p class="font-bold text-gray-800 line-clamp-1">${item.title}</p>
                <p class="text-xs text-gray-500">${item.category}</p>
              </div>
            </div>
          </td>
          <td class="px-6 py-4 font-bold text-gray-700">₹ ${item.price}</td>
          <td class="px-6 py-4"><span class="px-2 py-1 bg-green-100 text-green-700 rounded-full text-xs font-bold">Active</span></td>
          <td class="px-6 py-4 text-center font-medium text-gray-600">${Math.floor(Math.random()*500)}</td>
          <td class="px-6 py-4 text-right">
            <div class="flex justify-end gap-2 opacity-0 group-hover:opacity-100 transition-opacity">
              <button onclick="editItem('${item.id}')" class="p-2 text-gray-400 hover:text-blue-500 bg-white border border-gray-200 rounded-lg shadow-sm hover:shadow"><span class="material-symbols-outlined text-base">edit</span></button>
              <button onclick="deleteItem('${item.id}')" class="p-2 text-gray-400 hover:text-red-500 bg-white border border-gray-200 rounded-lg shadow-sm hover:shadow"><span class="material-symbols-outlined text-base">delete</span></button>
            </div>
          </td>
        </tr>
      `).join('');
    }

    window.deleteItem = (id) => {
      if(confirm("Are you sure you want to delete this listing?")) {
        let listings = JSON.parse(localStorage.getItem('zzz_listings') || '[]');
        listings = listings.filter(l => l.id != id);
        localStorage.setItem('zzz_listings', JSON.stringify(listings));
        loadListings();
      }
    }

    window.editItem = (id) => {
      alert("Edit feature coming next! (Redirect to Post Listing with ID)");
    }

    // --- 4. NAVIGATION LOGIC ---
    window.showSection = (id) => {
      ['dashboard', 'listings', 'payouts', 'settings'].forEach(sid => {
        document.getElementById(sid).classList.add('hidden');
        const nav = document.getElementById('nav-' + sid);
        if(nav) nav.classList.remove('active', 'bg-green-50', 'text-primary', 'border-r-4', 'border-primary');
      });

      document.getElementById(id).classList.remove('hidden');
      const activeNav = document.getElementById('nav-' + id);
      if(activeNav) activeNav.classList.add('active'); // CSS class handles style
      document.getElementById('pageTitle').textContent = id.charAt(0).toUpperCase() + id.slice(1);
    }

    window.handleLogout = () => {
      localStorage.removeItem('zzz_user');
      window.location.href = 'Login Page.html';
    }

    // --- 5. CHARTS INIT ---
    function initChart() {
      const ctx = document.getElementById('sellerChart').getContext('2d');
      new Chart(ctx, {
        type: 'line',
        data: {
          labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
          datasets: [
            { label: 'Views', data: [120, 190, 300, 250, 200, 350, 400], borderColor: '#019863', tension: 0.4, fill: true, backgroundColor: 'rgba(1, 152, 99, 0.05)' },
            { label: 'Clicks', data: [80, 100, 150, 120, 90, 180, 220], borderColor: '#4D96A9', tension: 0.4, borderDash: [5, 5] }
          ]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: { legend: { position: 'top' } },
          scales: { y: { beginAtZero: true } }
        }
      });
    }

    // STARTUP
    loadListings();
    updateMessageStats();
    setTimeout(initChart, 100);

  </script>
</body>
</html>