<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Console V2 - ZipZapZoi</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght@300;400;600&display=swap">
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .material-symbols-outlined {
      font-variation-settings: 'FILL' 0, 'wght' 400, 'GRAD' 0, 'opsz' 24;
    }
    body { font-family: system-ui, -apple-system, sans-serif; }
    .sidebar { background: #1a2332; }
    .sidebar a { color: #9ca3af; transition: all 0.3s; }
    .sidebar a.active { color: #10b981; background: rgba(16,185,129,0.1); }
    .sidebar a:hover { color: #10b981; }
    .card { background: white; border-radius: 12px; padding: 24px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); }
    .btn-primary { background: #2563eb; color: white; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-size: 14px; font-weight: 500; }
    .btn-primary:hover { background: #1d4ed8; }
    .btn-secondary { background: #10b981; color: white; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-size: 14px; font-weight: 500; }
    .btn-secondary:hover { background: #059669; }
    .field-card { background: #f9fafb; border: 1px solid #e5e7eb; border-radius: 8px; padding: 12px; margin-bottom: 8px; }
    .field-card h4 { margin: 0 0 4px 0; font-weight: 600; font-size: 14px; }
    .field-card p { margin: 0; font-size: 12px; color: #6b7280; }
    .hidden { display: none; }
    .section-content { display: none; }
    .section-content.active { display: block; }
  </style>
</head>
<body class="bg-gray-50">

<div class="flex h-screen">
  <!-- Sidebar -->
  <aside class="sidebar w-64 text-white p-6 overflow-y-auto">
    <div class="mb-8">
      <h1 class="text-2xl font-bold text-cyan-400">‚óÜ ZipZapZoi</h1>
      <p class="text-sm text-gray-400 mt-1">Admin Console</p>
    </div>

    <nav class="space-y-2">
      <a href="#" class="nav-link active block px-4 py-2 rounded-lg flex items-center gap-3" data-section="dashboard">
        <span class="material-symbols-outlined">dashboard</span> Dashboard
      </a>
      <a href="#" class="nav-link block px-4 py-2 rounded-lg flex items-center gap-3" data-section="listings">
        <span class="material-symbols-outlined">view_list</span> Listings
      </a>
      <a href="#" class="nav-link block px-4 py-2 rounded-lg flex items-center gap-3" data-section="users">
        <span class="material-symbols-outlined">group</span> Users
      </a>
      <a href="#" class="nav-link block px-4 py-2 rounded-lg flex items-center gap-3" data-section="categories">
        <span class="material-symbols-outlined">folder_managed</span> Categories
      </a>
      <a href="#" class="nav-link block px-4 py-2 rounded-lg flex items-center gap-3" data-section="payments">
        <span class="material-symbols-outlined">credit_card</span> Payments
      </a>
      <a href="#" class="nav-link block px-4 py-2 rounded-lg flex items-center gap-3" data-section="reports">
        <span class="material-symbols-outlined">analytics</span> Reports
      </a>
      <a href="#" class="nav-link block px-4 py-2 rounded-lg flex items-center gap-3" data-section="roles">
        <span class="material-symbols-outlined">security</span> Roles
      </a>
      <a href="#" class="nav-link block px-4 py-2 rounded-lg flex items-center gap-3" data-section="settings">
        <span class="material-symbols-outlined">tune</span> Settings
      </a>
    </nav>

    <hr class="my-6 border-gray-700">

    <a href="#" class="block px-4 py-2 rounded-lg flex items-center gap-3 text-red-400 hover:bg-red-900/20">
      <span class="material-symbols-outlined">logout</span> Logout
    </a>
  </aside>

  <!-- Main Content -->
  <main class="flex-1 overflow-y-auto">
    <div class="bg-white border-b border-gray-200 px-8 py-6 flex items-center justify-between sticky top-0 z-10">
      <h1 class="text-3xl font-bold" id="pageTitle">Dashboard</h1>
      <div class="flex items-center gap-4">
        <input type="text" placeholder="Search..." class="px-4 py-2 border border-gray-300 rounded-lg">
        <div class="flex items-center gap-2 text-gray-700">
          <span class="material-symbols-outlined">account_circle</span> Admin
        </div>
      </div>
    </div>

    <div class="p-8">

      <!-- DASHBOARD SECTION -->
      <section id="dashboard" class="section-content active">
        <!-- Dashboard Stats -->
        <div class="grid grid-cols-4 gap-6 mb-8">
          <div class="card">
            <p class="text-gray-600 text-sm">Listings Pending</p>
            <p class="text-3xl font-bold mt-2">124</p>
            <p class="text-green-600 text-xs mt-1">‚Üë 5% from yesterday</p>
          </div>
          <div class="card">
            <p class="text-gray-600 text-sm">Active Users Today</p>
            <p class="text-3xl font-bold mt-2">1,230</p>
            <p class="text-green-600 text-xs mt-1">‚Üë 2.1% increase</p>
          </div>
          <div class="card">
            <p class="text-gray-600 text-sm">New Registrations</p>
            <p class="text-3xl font-bold mt-2">88</p>
            <p class="text-red-600 text-xs mt-1">‚Üì 1.5% decrease</p>
          </div>
          <div class="card">
            <p class="text-gray-600 text-sm">Revenue (This Month)</p>
            <p class="text-3xl font-bold mt-2">$15,480</p>
            <p class="text-green-600 text-xs mt-1">‚Üë 8.2% growth</p>
          </div>
        </div>

        <div class="grid grid-cols-3 gap-6 mb-8">
          <div class="card">
            <h3 class="text-lg font-semibold mb-4">Revenue Trend</h3>
            <p class="text-gray-600">Chart placeholder</p>
          </div>
          <div class="card">
            <h3 class="text-lg font-semibold mb-4">Listing Status</h3>
            <p class="text-gray-600">Chart placeholder</p>
          </div>
          <div class="card">
            <h3 class="text-lg font-semibold mb-4">Moderation Queue</h3>
            <p class="text-gray-600">Queue data</p>
          </div>
        </div>
      </section>

      <!-- CATEGORIES & FIELD MANAGER SECTION -->
      <section id="categories" class="section-content">
        <h2 class="text-2xl font-bold mb-8">Category & Field Manager</h2>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">

          <!-- CATEGORIES COLUMN -->
          <div class="bg-white rounded-lg border border-gray-200 p-6 shadow-sm">
            <div class="flex items-center justify-between mb-4">
              <h3 class="text-lg font-semibold flex items-center gap-2">
                <span class="material-symbols-outlined">folder_managed</span>
                Categories
              </h3>
              <button id="btnAddCategory" class="btn-secondary text-xs flex items-center gap-1">
                <span class="material-symbols-outlined text-sm">add</span>
              </button>
            </div>
            <input type="text" id="searchCategories" placeholder="Search..." class="w-full px-3 py-2 border border-gray-300 rounded-lg mb-4 text-sm">
            <div class="border rounded-lg divide-y max-h-96 overflow-y-auto" id="categoriesList">
              <div class="p-3 text-sm text-gray-500">Loading...</div>
            </div>
          </div>

          <!-- SUBCATEGORIES COLUMN -->
          <div class="bg-white rounded-lg border border-gray-200 p-6 shadow-sm">
            <div class="flex items-center justify-between mb-4">
              <h3 class="text-lg font-semibold flex items-center gap-2">
                <span class="material-symbols-outlined">category</span>
                <span>Subcategories</span>
              </h3>
              <button id="btnAddSubcategory" class="btn-secondary text-xs flex items-center gap-1 disabled:opacity-40" disabled>
                <span class="material-symbols-outlined text-sm">add</span>
              </button>
            </div>
            <div class="mb-4 p-3 bg-blue-50 rounded-lg">
              <p class="text-sm font-semibold text-blue-900" id="subcategoriesFor">‚Äì</p>
            </div>
            <div class="border rounded-lg divide-y max-h-96 overflow-y-auto" id="subcategoriesList">
              <div class="p-3 text-sm text-gray-500">Select a category first.</div>
            </div>
          </div>

          <!-- CUSTOM FIELDS COLUMN -->
          <div class="bg-white rounded-lg border border-gray-200 p-6 shadow-sm">
            <div class="flex items-center justify-between mb-4">
              <h3 class="text-lg font-semibold flex items-center gap-2">
                <span class="material-symbols-outlined">tune</span>
                <span>Custom Fields</span>
              </h3>
              <button id="btnAddField" class="btn-secondary text-xs flex items-center gap-1 disabled:opacity-40" disabled>
                <span class="material-symbols-outlined text-sm">add</span>
              </button>
            </div>
            <div class="mb-4 p-3 bg-blue-50 rounded-lg">
              <p class="text-sm font-semibold text-blue-900" id="fieldsFor">‚Äì</p>
            </div>
            <div class="max-h-96 overflow-y-auto" id="fieldsList">
              <div class="p-3 text-sm text-gray-500">Select a subcategory first.</div>
            </div>
          </div>

        </div>
      </section>

      <!-- LISTINGS SECTION -->
      <section id="listings" class="section-content">
        <h2 class="text-2xl font-bold mb-6">Manage Listings</h2>
        <div class="card">
          <p class="text-gray-600">Browse all listings, approve/reject, and manage content.</p>
        </div>
      </section>

      <!-- USERS SECTION -->
      <section id="users" class="section-content">
        <h2 class="text-2xl font-bold mb-6">Manage Users</h2>
        <div class="card">
          <p class="text-gray-600">View all registered users and manage accounts.</p>
        </div>
      </section>

      <!-- PAYMENTS SECTION -->
      <section id="payments" class="section-content">
        <h2 class="text-2xl font-bold mb-6">Payments & Subscriptions</h2>
        <div class="grid grid-cols-3 gap-6 mb-8">
          <div class="card">
            <p class="text-gray-600 text-sm">üí∞ Total Revenue</p>
            <p class="text-3xl font-bold mt-2">$120,450</p>
            <p class="text-green-600 text-xs mt-1">‚Üë 2.5% this month</p>
          </div>
          <div class="card">
            <p class="text-gray-600 text-sm">‚è≥ Pending Refunds</p>
            <p class="text-3xl font-bold mt-2">15</p>
            <p class="text-green-600 text-xs mt-1">‚Üë 5.1% increase</p>
          </div>
          <div class="card">
            <p class="text-gray-600 text-sm">üìã Active Subscriptions</p>
            <p class="text-3xl font-bold mt-2">2,340</p>
            <p class="text-red-600 text-xs mt-1">‚Üì 0.5% decrease</p>
          </div>
        </div>
      </section>

      <!-- REPORTS SECTION -->
      <section id="reports" class="section-content">
        <h2 class="text-2xl font-bold mb-6">Reports & Analytics</h2>
        <div class="card">
          <p class="text-gray-600">View detailed reports and analytics.</p>
        </div>
      </section>

      <!-- ROLES SECTION -->
      <section id="roles" class="section-content">
        <h2 class="text-2xl font-bold mb-6">Roles & Permissions</h2>
        <div class="card">
          <p class="text-gray-600">Manage user roles and permissions.</p>
        </div>
      </section>

      <!-- SETTINGS SECTION -->
      <section id="settings" class="section-content">
        <h2 class="text-2xl font-bold mb-6">Settings</h2>
        <div class="card">
          <p class="text-gray-600">Configure admin console settings.</p>
        </div>
      </section>

    </div>
  </main>
</div>

<!-- FIELD MANAGER & NAVIGATION SCRIPT -->
<script>
// ====== FIELD MANAGER ======
const STORAGE_KEY = 'zzz_classifieds_schema';
let schema = {
  categories: [
    { id: 'vehicles', label: 'Vehicles', icon: 'directions_car' },
    { id: 'electronics', label: 'Electronics', icon: 'devices' },
    { id: 'property', label: 'Real Estate', icon: 'real_estate_agent' },
    { id: 'fashion', label: 'Fashion', icon: 'checkroom' }
  ],
  subcategories: [],
  fields: []
};

let state = {
  selectedCategoryId: null,
  selectedSubcategoryId: null,
  searchText: ''
};

// Load from localStorage if exists
function loadSchema() {
  try {
    const saved = localStorage.getItem(STORAGE_KEY);
    if (saved) {
      schema = JSON.parse(saved);
      console.log('Schema loaded from localStorage:', schema);
    }
  } catch (e) {
    console.error('Error loading schema:', e);
  }
}

function saveSchema() {
  try {
    localStorage.setItem(STORAGE_KEY, JSON.stringify(schema));
    console.log('Schema saved to localStorage');
  } catch (e) {
    console.error('Error saving schema:', e);
  }
}

function uid(prefix) {
  return prefix + '_' + Math.random().toString(36).slice(2, 9);
}

// RENDER FUNCTIONS
function renderCategories() {
  const list = document.getElementById('categoriesList');
  if (!list) return;
  
  console.log('Rendering categories:', schema.categories);

  if (!schema.categories || schema.categories.length === 0) {
    list.innerHTML = '<div class="p-3 text-sm text-gray-500">No categories. Click Add.</div>';
    return;
  }

  const filtered = schema.categories.filter(c =>
    c.label.toLowerCase().includes(state.searchText.toLowerCase())
  );

  list.innerHTML = filtered.map(c => {
    const active = c.id === state.selectedCategoryId;
    return `
      <button
        type="button"
        class="w-full text-left px-3 py-2 text-sm ${
          active ? 'bg-blue-500 text-white' : 'bg-white text-gray-800 hover:bg-gray-50'
        } border-b last:border-b-0 flex items-center justify-between"
        data-cat-id="${c.id}"
      >
        <span class="flex items-center gap-2">
          <span class="material-symbols-outlined text-base">${c.icon || 'category'}</span>
          ${c.label}
        </span>
        <span class="flex items-center gap-1 text-xs opacity-60">
          <span class="material-symbols-outlined text-sm cursor-pointer" data-action="edit-cat">edit</span>
          <span class="material-symbols-outlined text-sm cursor-pointer" data-action="delete-cat">delete</span>
        </span>
      </button>
    `;
  }).join('');
}

function renderSubcategories() {
  const list = document.getElementById('subcategoriesList');
  const info = document.getElementById('subcategoriesFor');
  const btn = document.getElementById('btnAddSubcategory');
  if (!list || !info || !btn) return;

  const cat = schema.categories.find(c => c.id === state.selectedCategoryId);
  info.textContent = cat ? cat.label : '‚Äì';
  btn.disabled = !state.selectedCategoryId;

  if (!state.selectedCategoryId) {
    list.innerHTML = '<div class="p-3 text-sm text-gray-500">Select a category first.</div>';
    return;
  }

  const subs = schema.subcategories.filter(s => s.categoryId === state.selectedCategoryId);

  if (subs.length === 0) {
    list.innerHTML = '<div class="p-3 text-sm text-gray-500">No subcategories. Click Add.</div>';
    return;
  }

  list.innerHTML = subs.map(s => {
    const active = s.id === state.selectedSubcategoryId;
    return `
      <button
        type="button"
        class="w-full text-left px-3 py-2 text-sm ${
          active ? 'bg-blue-500 text-white' : 'bg-white text-gray-800 hover:bg-gray-50'
        } border-b last:border-b-0 flex items-center justify-between"
        data-sub-id="${s.id}"
      >
        <span>${s.label}</span>
        <span class="flex items-center gap-1 text-xs opacity-60">
          <span class="material-symbols-outlined text-sm cursor-pointer" data-action="edit-sub">edit</span>
          <span class="material-symbols-outlined text-sm cursor-pointer" data-action="delete-sub">delete</span>
        </span>
      </button>
    `;
  }).join('');
}

function renderFields() {
  const list = document.getElementById('fieldsList');
  const info = document.getElementById('fieldsFor');
  const btn = document.getElementById('btnAddField');
  if (!list || !info || !btn) return;

  const sub = schema.subcategories.find(s => s.id === state.selectedSubcategoryId);
  info.textContent = sub ? sub.label : '‚Äì';
  btn.disabled = !state.selectedSubcategoryId;

  if (!state.selectedSubcategoryId) {
    list.innerHTML = '<div class="p-3 text-sm text-gray-500">Select a subcategory first.</div>';
    return;
  }

  const fields = schema.fields.filter(f => f.subcategoryId === state.selectedSubcategoryId);

  if (fields.length === 0) {
    list.innerHTML = '<div class="p-3 text-sm text-gray-500">No fields. Click Add.</div>';
    return;
  }

  list.innerHTML = fields.map(f => `
    <div class="field-card">
      <div class="flex items-center justify-between">
        <div class="flex-1">
          <h4>${f.label}</h4>
          <p>Type: ${f.type}${f.required ? ' ‚Ä¢ Required' : ''}</p>
        </div>
        <span class="flex items-center gap-1 text-xs">
          <span class="material-symbols-outlined text-sm cursor-pointer" data-field-id="${f.id}" data-action="edit-field">edit</span>
          <span class="material-symbols-outlined text-sm cursor-pointer" data-field-id="${f.id}" data-action="delete-field">delete</span>
        </span>
      </div>
    </div>
  `).join('');
}

function renderAll() {
  renderCategories();
  renderSubcategories();
  renderFields();
}

// EVENT LISTENERS - Add Category
document.getElementById('btnAddCategory')?.addEventListener('click', () => {
  const label = prompt('Category name:');
  if (!label) return;
  const id = label.toLowerCase().replace(/[^a-z0-9]+/g, '-');
  schema.categories.push({ id, label, icon: 'category' });
  if (!state.selectedCategoryId) state.selectedCategoryId = id;
  saveSchema();
  renderAll();
});

// Add Subcategory
document.getElementById('btnAddSubcategory')?.addEventListener('click', () => {
  if (!state.selectedCategoryId) return;
  const label = prompt('Subcategory name:');
  if (!label) return;
  const id = uid('sub');
  schema.subcategories.push({ id, categoryId: state.selectedCategoryId, label });
  state.selectedSubcategoryId = id;
  saveSchema();
  renderAll();
});

// Add Field
document.getElementById('btnAddField')?.addEventListener('click', () => {
  if (!state.selectedSubcategoryId) return;
  const label = prompt('Field label:');
  if (!label) return;
  const type = prompt('Field type (text, number, date, dropdown, checkbox):', 'text');
  if (!type) return;
  const required = confirm('Should this field be required?');
  const id = uid('field');
  schema.fields.push({ id, subcategoryId: state.selectedSubcategoryId, label, type: type.toLowerCase(), required });
  saveSchema();
  renderFields();
});

// Search
document.getElementById('searchCategories')?.addEventListener('input', (e) => {
  state.searchText = e.target.value;
  renderCategories();
});

// Categories list delegation
document.getElementById('categoriesList')?.addEventListener('click', (e) => {
  const btn = e.target.closest('button[data-cat-id]');
  if (!btn) return;
  
  const id = btn.getAttribute('data-cat-id');
  const action = e.target.getAttribute('data-action');

  if (!action) {
    // Click on category itself
    state.selectedCategoryId = id;
    state.selectedSubcategoryId = null;
    renderAll();
    return;
  }

  const cat = schema.categories.find(c => c.id === id);
  if (!cat) return;

  if (action === 'edit-cat') {
    const newLabel = prompt('Edit category name:', cat.label);
    if (!newLabel) return;
    cat.label = newLabel;
    saveSchema();
    renderAll();
  } else if (action === 'delete-cat') {
    if (!confirm('Delete this category and all its data?')) return;
    schema.categories = schema.categories.filter(c => c.id !== id);
    const subIds = schema.subcategories.filter(s => s.categoryId === id).map(s => s.id);
    schema.subcategories = schema.subcategories.filter(s => s.categoryId !== id);
    schema.fields = schema.fields.filter(f => !subIds.includes(f.subcategoryId));
    if (state.selectedCategoryId === id) {
      state.selectedCategoryId = null;
      state.selectedSubcategoryId = null;
    }
    saveSchema();
    renderAll();
  }
});

// Subcategories list delegation
document.getElementById('subcategoriesList')?.addEventListener('click', (e) => {
  const btn = e.target.closest('button[data-sub-id]');
  if (!btn) return;

  const id = btn.getAttribute('data-sub-id');
  const action = e.target.getAttribute('data-action');

  if (!action) {
    // Click on subcategory itself
    state.selectedSubcategoryId = id;
    renderFields();
    renderSubcategories();
    return;
  }

  const sub = schema.subcategories.find(s => s.id === id);
  if (!sub) return;

  if (action === 'edit-sub') {
    const newLabel = prompt('Edit subcategory name:', sub.label);
    if (!newLabel) return;
    sub.label = newLabel;
    saveSchema();
    renderAll();
  } else if (action === 'delete-sub') {
    if (!confirm('Delete this subcategory and its fields?')) return;
    schema.subcategories = schema.subcategories.filter(s => s.id !== id);
    schema.fields = schema.fields.filter(f => f.subcategoryId !== id);
    if (state.selectedSubcategoryId === id) state.selectedSubcategoryId = null;
    saveSchema();
    renderAll();
  }
});

// Fields list delegation
document.getElementById('fieldsList')?.addEventListener('click', (e) => {
  const action = e.target.getAttribute('data-action');
  const fieldId = e.target.getAttribute('data-field-id');
  if (!action || !fieldId) return;

  const field = schema.fields.find(f => f.id === fieldId);
  if (!field) return;

  if (action === 'edit-field') {
    const label = prompt('Field label:', field.label);
    if (!label) return;
    const type = prompt('Field type:', field.type);
    if (!type) return;
    const required = confirm('Required?');
    field.label = label;
    field.type = type.toLowerCase();
    field.required = required;
    saveSchema();
    renderFields();
  } else if (action === 'delete-field') {
    if (!confirm('Delete this field?')) return;
    schema.fields = schema.fields.filter(f => f.id !== fieldId);
    saveSchema();
    renderFields();
  }
});

// Load on page start
loadSchema();
renderAll();

// ====== NAVIGATION ======
document.querySelectorAll('.nav-link').forEach(link => {
  link.addEventListener('click', (e) => {
    e.preventDefault();
    
    document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
    link.classList.add('active');
    
    const sectionId = link.getAttribute('data-section');
    
    const titles = {
      dashboard: 'Dashboard',
      listings: 'Manage Listings',
      users: 'Manage Users',
      categories: 'Category & Field Manager',
      payments: 'Payments & Subscriptions',
      reports: 'Reports & Analytics',
      roles: 'Roles & Permissions',
      settings: 'Settings'
    };
    
    document.getElementById('pageTitle').textContent = titles[sectionId] || 'Dashboard';
    
    document.querySelectorAll('.section-content').forEach(section => {
      section.classList.remove('active');
    });
    
    const activeSection = document.getElementById(sectionId);
    if (activeSection) activeSection.classList.add('active');
    
    // Re-render when switching to categories
    if (sectionId === 'categories') {
      console.log('Switching to categories, re-rendering...');
      renderAll();
    }
  });
});
</script>

</body>
</html>