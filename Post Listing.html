<!DOCTYPE html>
<html class="light" lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>ZipZapZoi - Create a New Listing</title>
  <style>
  /* focus styles for keyboard users */
  :focus {
    outline: 3px solid rgba(77,150,255,0.25);
    outline-offset: 2px;
  }
  </style>
  <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
  <link href="https://fonts.googleapis.com" rel="preconnect"/>
  <link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
  <link href="https://fonts.googleapis.com/css2?family=Spline+Sans:wght@300..700&display=swap" rel="stylesheet"/>
  <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet"/>
  <script>
    tailwind.config = {
      darkMode: "class",
      theme: {
        extend: {
          colors: {
            "primary": "#FF6B6B",
            "secondary": "#4D96FF",
            "background-light": "#F8F9FA",
            "background-dark": "#1A1B1C",
            "card-light": "#FFFFFF",
            "card-dark": "#2C2D2E",
            "text-light": "#343A40",
            "text-dark": "#E9ECEF",
            "text-muted-light": "#6C757D",
            "text-muted-dark": "#ADB5BD",
            "border-light": "#E9ECEF",
            "border-dark": "#495057",
            "success": "#1DD1A1"
          },
          fontFamily: {
            "display": ["Spline Sans", "sans-serif"]
          },
          borderRadius: {
            "DEFAULT": "1rem",
            "lg": "1.5rem",
            "xl": "2rem",
            "full": "9999px"
          },
          boxShadow: {
            'bouncy': '0 10px 25px -5px rgba(0, 0, 0, 0.05), 0 8px 10px -6px rgba(0, 0, 0, 0.05)',
            'bouncy-lg': '0 20px 30px -10px rgba(0, 0, 0, 0.1), 0 10px 15px -8px rgba(0, 0, 0, 0.1)',
          }
        },
      },
    }
  </script>
  <script src="js/data-manager.js"></script>
</head>
<body class="font-display bg-background-light dark:bg-background-dark text-text-light dark:text-text-dark antialiased">
<div class="relative flex h-auto min-h-screen w-full flex-col group/design-root overflow-x-hidden">
  <!-- TopNavBar -->
  <header class="sticky top-0 z-10 w-full bg-card-light/80 dark:bg-card-dark/80 backdrop-blur-md">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex items-center justify-between h-16">
        <div class="flex items-center gap-8">
          <div class="flex items-center gap-2 text-text-light dark:text-text-dark">
            <span class="material-symbols-outlined text-secondary text-3xl">all_inclusive</span>
            <h2 class="text-xl font-bold">ZipZapZoi</h2>
          </div>
        </div>
        <div class="hidden md:flex flex-1 justify-end gap-6 items-center">
          <a class="text-sm font-medium hover:text-secondary" href="#">Browse</a>
          <a class="text-sm font-medium hover:text-secondary" href="#">Messages</a>
          <a class="text-sm font-medium hover:text-secondary" href="#">Help</a>
          <button class="flex max-w-[480px] cursor-pointer items-center justify-center overflow-hidden rounded-full h-10 bg-card-light dark:bg-card-dark border border-border-light dark:border-border-dark text-text-light dark:text-text-dark gap-2 text-sm font-bold leading-normal tracking-[0.015em] min-w-0 px-2.5 hover:border-secondary transition-colors">
            <span class="material-symbols-outlined text-xl">notifications</span>
          </button>
          <div class="bg-center bg-no-repeat aspect-square bg-cover rounded-full size-10" data-alt="User profile picture" style='background-image: url("https://lh3.googleusercontent.com/aida-public/AB6AXuCk1SS5_zFqd51Qg2LVvuPaNkfTZ5rCqFM0NJIfdCVIOLhqxKr9Af8YSTK4GvnUe3VDHNFZPLksrEmewWN7ceWpig_63IdBrs_tdjjC8Vx7n2T3lafIGJHajkFPTxdlgZpiy2xOLYl5XJPCl1pb4pcEMxBuVxLrXIRwC0ljYThbZktHomGpST8u4Ury82dzGYgWuKP31WpzCIti4-G0PEPk_mZ5w5hq_bNPRYOgwcRk9FuPV00Tmflf5eKqlaY8UaToCWW2PYoTYQj_");'></div>
        </div>
      </div>
    </div>
  </header>

  <!-- Main Content -->
  <main class="flex-1 w-full py-12 md:py-20">
    <div class="layout-content-container flex flex-col max-w-3xl mx-auto px-4 sm:px-6 lg:px-8 gap-10">
      <!-- ProgressBar -->
      <div class="flex flex-col gap-3">
        <div class="flex gap-6 justify-between">
          <p class="text-base font-medium">Step 1 of 5</p>
        </div>
        <div class="rounded-full bg-border-light dark:bg-border-dark h-3 overflow-hidden">
          <div class="h-full rounded-full bg-primary transition-all duration-500" style="width: 20%;"></div>
        </div>
      </div>

      <!-- Form Content Card -->
      <div class="bg-card-light dark:bg-card-dark rounded-xl shadow-bouncy-lg p-6 sm:p-10 flex flex-col gap-8">
        <div class="flex flex-wrap justify-between gap-3">
          <div class="flex min-w-72 flex-col gap-3">
            <p class="text-4xl font-black leading-tight tracking-[-0.033em] text-text-light dark:text-text-dark">What are you selling?</p>
            <p class="text-base font-normal leading-normal text-text-muted-light dark:text-text-muted-dark">Choose a category to get started. This helps buyers find your item.</p>
          </div>
        </div>

        <!-- Category cards (TOP) -->
        <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mt-6">
          <div class="group flex flex-col gap-3 p-3 rounded-lg cursor-pointer border-2 border-transparent hover:border-primary hover:bg-primary/10 dark:hover:bg-primary/20 transition-all transform hover:-translate-y-1" data-category="Vehicles">
            <div class="w-full bg-center bg-no-repeat aspect-square bg-cover rounded-lg" style='background-image: url("https://lh3.googleusercontent.com/aida-public/AB6AXuAnG74ulNSzqLN0MYtT6ErPt17JZmLqW_NKc9r2B6c1Y0Lp1Gl0jWVl1EdsYZM_7Z5JdehlLmlq8Tm7aWGIb65Mg0O5BUGlrQ8sU8jOubfq5uROFh_x5pXhP6Z0BTRgPBzsDMvRWcV7PCv7hq2xLLKXslnZGiVYnoPMA_updcH36QmD3C9NJBPsQk_i5_NX3DairwNY2TuTjO7kRXTTXgZGWYjFFKH9uR-FDph0r-TGkzPDScp6vbw7BuXa6YEh-C3PvjSjIlYehx04");'></div>
            <div>
              <p class="text-base font-medium text-text-light dark:text-text-dark">Vehicles</p>
              <p class="text-sm font-normal text-text-muted-light dark:text-text-muted-dark">Cars, bikes &amp; boats</p>
            </div>
          </div>

          <div class="group flex flex-col gap-3 p-3 rounded-lg cursor-pointer border-2 border-transparent hover:border-primary hover:bg-primary/10 dark:hover:bg-primary/20 transition-all transform hover:-translate-y-1" data-category="Home & Garden">
            <div class="w-full bg-center bg-no-repeat aspect-square bg-cover rounded-lg" style='background-image: url("https://lh3.googleusercontent.com/aida-public/AB6AXuAWPLTsUEaNUU_CvjTn0Xp2cEUdr2mBodcq9EiV-4PxZ6SeoGCZbeJAUfEcyaHEuTMuBjpFxyTs8qN3LTu_mjNI7MxFmX_WkF3RuBaw_WYZakzgIXuIGprYBuSMRxVvYopEBD0m5UCvrvUqKbyo_EFzColCY7CenEX1CpS3qf-l3wuq89v3EtIGedD5FOM80_gWZtP4OlvYhXliMy5RJIa3QAdL7AVYzH-Ibg2RYmb5JEiX3_5NOZyK6xwG889R836AQFATeeBX2MNM");'></div>
            <div>
              <p class="text-base font-medium text-text-light dark:text-text-dark">Home &amp; Garden</p>
              <p class="text-sm font-normal text-text-muted-light dark:text-text-muted-dark">Furniture &amp; decor</p>
            </div>
          </div>

          <div class="group flex flex-col gap-3 p-3 rounded-lg cursor-pointer border-2 border-transparent hover:border-primary hover:bg-primary/10 dark:hover:bg-primary/20 transition-all transform hover:-translate-y-1" data-category="Electronics">
            <div class="w-full bg-center bg-no-repeat aspect-square bg-cover rounded-lg" style='background-image: url("https://lh3.googleusercontent.com/aida-public/AB6AXuDhVpR1nycezXGqSv7fcu9K_npuM_34VYF05Ngy7SV0dwZ0f2qKxUpyKCvj8NwdVZuk2bC1iyiv-m3dNQVxbLJvI698rcLtl5FOda9z95w2oMkBohOAoGyu6qe5AupIWdCOob30Pct0FoZiT93xcf6hMJfTgTXP1b6H2C2fh3DgVLGuRlw_HzkwdFIRj_kwwlqIy8IrHKMOz05BrqUr-4hVHHMimbajTZQ4Ov01FuyJ7Hy05jYmrRrNlSfj1AWz9TbV0V2IdrUhTtkT");'></div>
            <div>
              <p class="text-base font-medium text-text-light dark:text-text-dark">Electronics</p>
              <p class="text-sm font-normal text-text-muted-light dark:text-text-muted-dark">Phones, laptops &amp; TVs</p>
            </div>
          </div>

          <!-- Add remaining cards here similar to above: Property, Fashion, Hobbies, Pets, Services -->
        </div>

        <!-- Subcategory -->
        <div class="space-y-1 mt-6">
          <label for="zzzSubcategorySelect" class="block text-sm font-medium text-gray-700">
            Subcategory
          </label>
          <select
            id="zzzSubcategorySelect"
            name="zzzSubcategorySelect"
            class="mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 text-sm"
          >
            <option value="">Choose a subcategory</option>
          </select>
        </div>

        <!-- Dynamic fields container -->
        <div id="zzzDynamicFields" class="space-y-4 mt-4"></div>
      </div>
    </div>
  </main>
</div>

<!-- Schema-driven subcategory + fields logic -->
<script>
(function () {
  const STORAGE_KEY = 'zzz_classifieds_schema';

  const CATEGORY_ID_MAP = {
    'Vehicles': 'vehicles',
    'Home & Garden': 'property',
    'Electronics': 'electronics',
    'Property': 'property',
    'Fashion': 'fashion',
    'Hobbies': 'hobbies',
    'Pets': 'pets',
    'Services': 'services'
  };

  function loadSchema() {
    try {
      const raw = localStorage.getItem(STORAGE_KEY);
      if (!raw) return null;
      return JSON.parse(raw);
    } catch {
      return null;
    }
  }

  const schema = loadSchema();
  if (!schema) {
    console.warn('No schema found â€“ configure categories in AdminConsoleV2 first.');
    return;
  }

  let selectedCategoryId = null;
  let selectedSubcategoryId = null;

  const fieldsContainer = document.getElementById('zzzDynamicFields');
  const subSelect = document.getElementById('zzzSubcategorySelect');
  if (!fieldsContainer || !subSelect) return;

  function populateSubcategories() {
    subSelect.innerHTML = '<option value="">Choose a subcategory</option>';
    fieldsContainer.innerHTML = '';

    if (!selectedCategoryId) return;

    const subs = (schema.subcategories || []).filter(
      s => s.categoryId === selectedCategoryId
    );

    if (!subs.length) {
      const opt = document.createElement('option');
      opt.value = '';
      opt.textContent = 'No subcategories configured';
      subSelect.appendChild(opt);
      return;
    }

    subs.forEach(sub => {
      const opt = document.createElement('option');
      opt.value = sub.id;
      opt.textContent = sub.label;
      subSelect.appendChild(opt);
    });
  }

  function renderFields() {
    fieldsContainer.innerHTML = '';
    if (!selectedSubcategoryId) return;

    const fields = (schema.fields || []).filter(
      f => f.subcategoryId === selectedSubcategoryId
    );

    if (!fields.length) {
      fieldsContainer.innerHTML =
        '<p class="text-sm text-gray-500">No extra fields for this subcategory.</p>';
      return;
    }

    fields.forEach(field => {
      const wrapper = document.createElement('div');
      wrapper.className = 'space-y-1';

      const label = document.createElement('label');
      label.className = 'block text-sm font-medium text-gray-700';
      label.textContent = field.label + (field.required ? ' *' : '');
      label.htmlFor = 'zzzField_' + field.id;

      const baseClasses = 'mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 text-sm';
      let input;

      switch ((field.type || 'text').toLowerCase()) {
        case 'number':
          input = document.createElement('input');
          input.type = 'number';
          input.className = baseClasses;
          break;
        case 'date':
          input = document.createElement('input');
          input.type = 'date';
          input.className = baseClasses;
          break;
        case 'dropdown':
          input = document.createElement('select');
          input.className = baseClasses;
          const opt = document.createElement('option');
          opt.value = '';
          opt.textContent = 'Select...';
          input.appendChild(opt);
          break;
        case 'checkbox':
          input = document.createElement('input');
          input.type = 'checkbox';
          input.className = 'h-4 w-4 text-blue-600 border-gray-300 rounded';
          break;
        default:
          input = document.createElement('input');
          input.type = 'text';
          input.className = baseClasses;
      }

      input.id = 'zzzField_' + field.id;
      input.name = 'zzzField_' + field.id;
      if (field.required) input.required = true;

      wrapper.appendChild(label);
      wrapper.appendChild(input);
      fieldsContainer.appendChild(wrapper);
    });
  }

  subSelect.addEventListener('change', (e) => {
    selectedSubcategoryId = e.target.value || null;
    renderFields();
  });

  // Wire category cards to schema logic
  const cards = document.querySelectorAll('[data-category]');
  cards.forEach(card => {
    const label = card.getAttribute('data-category') || card.querySelector('p')?.textContent.trim();
    if (label) card.setAttribute('data-category-label', label);

    card.addEventListener('click', () => {
      const lbl = card.getAttribute('data-category-label');
      const catId = CATEGORY_ID_MAP[lbl] || null;
      selectedCategoryId = catId;
      selectedSubcategoryId = null;
      populateSubcategories();
    });
  });
})();
</script>

<!-- Card selection UI behaviour (purely visual, no Next/redirect) -->
<script>
(function(){
  const categories = document.querySelectorAll('.grid .group, .group');
  let selected = null;

  categories.forEach(cat=>{
    cat.addEventListener('click', ()=>{
      categories.forEach(c=>c.classList.remove('border-primary','bg-primary/10','dark:bg-primary/20','-translate-y-1'));
      cat.classList.add('border-primary','bg-primary/10','dark:bg-primary/20','-translate-y-1');
      selected = cat.dataset.category || (cat.querySelector('p') && cat.querySelector('p').textContent.trim());
      cat.setAttribute('aria-pressed','true');
    });

    cat.setAttribute('tabindex','0');
    cat.setAttribute('role','button');
    cat.addEventListener('keydown', (e) => {
      if(e.key === 'Enter' || e.key === ' ') { e.preventDefault(); cat.click(); }
    });
  });
})();
</script>

</body>
</html>
