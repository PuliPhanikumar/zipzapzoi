<!DOCTYPE html>
<html lang="en">
<head>
  <script>
  // --- AUTH CHECK ---
  (function() {
    const raw = localStorage.getItem('zzz_user');
    if (!raw) { window.location.href = 'Login Page.html'; }
  })();
  </script>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ZipZapZoi - Seller Dashboard</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Spline+Sans:wght@400;500;600;700&display=swap" rel="stylesheet"/>
  <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet"/>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: { sans: ["Spline Sans", "sans-serif"] },
          colors: { "primary": "#019863", "secondary": "#4D96A9", "background-light": "#F7F9FC" },
          boxShadow: { "bouncy": "0 10px 20px -5px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05)" }
        }
      }
    }
  </script>
  <style>
    .material-symbols-outlined { font-variation-settings: 'FILL' 0, 'wght' 400, 'GRAD' 0, 'opsz' 24; }
    .nav-item.active { background: #E6F4F1; color: #019863; border-right: 3px solid #019863; }
  </style>
</head>
<body class="bg-background-light h-screen flex overflow-hidden text-gray-800">

  <aside class="w-64 bg-white border-r border-gray-200 flex flex-col hidden md:flex z-20 shadow-xl">
    <div class="p-6 flex items-center gap-3 border-b border-gray-100">
      <span class="material-symbols-outlined text-primary text-3xl">all_inclusive</span>
      <div><h1 class="font-bold text-xl tracking-tight text-gray-800">ZipZapZoi</h1><p class="text-xs text-gray-500 uppercase tracking-wider">Seller Hub</p></div>
    </div>
    <nav class="flex-1 p-4 space-y-1 overflow-y-auto">
      <a href="#" onclick="showSection('dashboard')" id="nav-dashboard" class="nav-item flex items-center gap-3 px-4 py-3 rounded-lg text-gray-600 hover:bg-gray-50 transition-all font-medium active">
        <span class="material-symbols-outlined">dashboard</span> Dashboard
      </a>
      <a href="#" onclick="showSection('listings')" id="nav-listings" class="nav-item flex items-center gap-3 px-4 py-3 rounded-lg text-gray-600 hover:bg-gray-50 transition-all font-medium">
        <span class="material-symbols-outlined">inventory_2</span> My Listings
      </a>
      <a href="Inbox.html" class="nav-item flex items-center gap-3 px-4 py-3 rounded-lg text-gray-600 hover:bg-gray-50 transition-all font-medium">
        <span class="material-symbols-outlined">chat</span> Messages <span id="navMsgBadge" class="ml-auto bg-red-500 text-white text-[10px] font-bold px-2 py-0.5 rounded-full hidden">0</span>
      </a>
      <a href="#" onclick="showSection('payouts')" id="nav-payouts" class="nav-item flex items-center gap-3 px-4 py-3 rounded-lg text-gray-600 hover:bg-gray-50 transition-all font-medium">
        <span class="material-symbols-outlined">payments</span> Payouts
      </a>
      <a href="#" onclick="showSection('settings')" id="nav-settings" class="nav-item flex items-center gap-3 px-4 py-3 rounded-lg text-gray-600 hover:bg-gray-50 transition-all font-medium">
        <span class="material-symbols-outlined">settings</span> Settings
      </a>
    </nav>
    <div class="p-4 border-t border-gray-200">
      <a href="classifieds.html" class="flex items-center gap-2 text-sm text-gray-500 hover:text-primary mb-4 px-2"><span class="material-symbols-outlined text-lg">arrow_back</span> Back to Site</a>
      <button onclick="handleLogout()" class="w-full flex items-center justify-center gap-2 bg-red-50 text-red-600 py-2.5 rounded-lg font-bold hover:bg-red-100 transition-colors"><span class="material-symbols-outlined text-lg">logout</span> Logout</button>
    </div>
  </aside>

  <main class="flex-1 flex flex-col h-full relative overflow-hidden">
    <header class="flex items-center justify-between bg-white border-b border-gray-200 px-8 py-4">
      <h2 class="text-2xl font-bold text-gray-800" id="pageTitle">Dashboard</h2>
      <div class="flex items-center gap-6">
        <a href="Post Listing.html" class="flex items-center gap-2 bg-primary hover:bg-green-700 text-white px-5 py-2.5 rounded-full font-bold shadow-bouncy transition-transform hover:-translate-y-0.5"><span class="material-symbols-outlined text-lg">add_circle</span> Post New Ad</a>
        <div class="flex items-center gap-3 pl-6 border-l border-gray-200">
          <div class="w-10 h-10 rounded-full bg-primary/10 flex items-center justify-center text-primary font-bold text-lg" id="userInitial">U</div>
          <div><p class="text-sm font-bold text-gray-800" id="userName">User</p><p class="text-xs text-green-600 font-medium">Verified Seller</p></div>
        </div>
      </div>
    </header>

    <div class="flex-1 overflow-y-auto p-6 md:p-8 scroll-smooth" id="mainArea">
      <section id="dashboard" class="space-y-8">
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
          <div class="bg-gradient-to-br from-blue-500 to-blue-600 p-6 rounded-2xl shadow-lg text-white"><p class="text-blue-100 text-sm">Total Views</p><p class="text-4xl font-bold mt-1">12.5K</p></div>
          <div class="bg-gradient-to-br from-primary to-green-600 p-6 rounded-2xl shadow-lg text-white"><p class="text-green-100 text-sm">Active Chats</p><p class="text-4xl font-bold mt-1" id="dashChatCount">0</p><p class="text-xs bg-white/20 inline-block px-2 py-1 rounded mt-3 font-medium" id="dashUnreadText">0 New Messages</p></div>
          <div class="bg-white p-6 rounded-2xl shadow-bouncy border border-gray-100"><p class="text-gray-500 text-sm">Live Listings</p><p class="text-4xl font-bold text-gray-800 mt-1" id="liveCount">0</p><a href="#" onclick="showSection('listings')" class="text-xs text-primary font-bold mt-3 inline-block hover:underline">Manage Listings →</a></div>
          <div class="bg-white p-6 rounded-2xl shadow-bouncy border border-gray-100"><p class="text-gray-500 text-sm">Seller Rating</p><div class="flex items-center gap-1 mt-1"><span class="text-4xl font-bold text-gray-800">4.8</span><span class="material-symbols-outlined text-yellow-400">star</span></div></div>
        </div>
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
          <div class="lg:col-span-2 bg-white p-6 rounded-2xl shadow-bouncy border border-gray-100">
            <h3 class="font-bold text-lg text-gray-800 mb-4">Performance Analytics</h3>
            <div class="h-64 w-full"><canvas id="sellerChart"></canvas></div>
          </div>
          <div class="bg-white p-6 rounded-2xl shadow-bouncy border border-gray-100 flex flex-col">
            <h3 class="font-bold text-lg text-gray-800 mb-4">Recent Messages</h3>
            <div class="flex-1 space-y-4 overflow-y-auto pr-2" id="recentMsgList"></div>
            <a href="Inbox.html" class="mt-4 text-center text-sm font-bold text-primary hover:underline">View All Messages</a>
          </div>
        </div>
      </section>

      <section id="listings" class="hidden space-y-6">
        <div class="bg-white rounded-2xl shadow-bouncy border border-gray-100 overflow-hidden">
          <div class="p-6 border-b border-gray-100 flex justify-between items-center"><h3 class="font-bold text-lg text-gray-800">Your Listings</h3></div>
          <table class="w-full text-left">
            <thead class="bg-gray-50 border-b border-gray-100 text-xs uppercase text-gray-500 font-semibold">
              <tr><th class="px-6 py-4">Item</th><th class="px-6 py-4">Price</th><th class="px-6 py-4">Status</th><th class="px-6 py-4 text-right">Actions</th></tr>
            </thead>
            <tbody id="listingsTableBody" class="divide-y divide-gray-100 text-sm"></tbody>
          </table>
        </div>
      </section>

      <section id="payouts" class="hidden"><div class="bg-white p-10 rounded-2xl text-center"><h3 class="font-bold">Payouts Coming Soon</h3></div></section>
      <section id="settings" class="hidden"><div class="bg-white p-10 rounded-2xl text-center"><h3 class="font-bold">Settings Coming Soon</h3></div></section>
    </div>
  </main>

  <script>
    // --- 1. SETUP ---
    const user = JSON.parse(localStorage.getItem('zzz_user'));
    if(user){ document.getElementById('userName').textContent = user.name; document.getElementById('userInitial').textContent = user.name.charAt(0); }

    // --- 2. LISTINGS LOGIC ---
    function loadListings() {
      const allListings = JSON.parse(localStorage.getItem('zzz_listings') || '[]');
      const myListings = user ? allListings.filter(l => l.userId === user.id) : []; 
      
      document.getElementById('liveCount').textContent = myListings.length;
      const tbody = document.getElementById('listingsTableBody');
      
      if(myListings.length === 0) {
        tbody.innerHTML = `<tr><td colspan="4" class="p-8 text-center text-gray-400">No listings yet. <a href="Post Listing.html" class="text-primary hover:underline">Create one!</a></td></tr>`;
        return;
      }

      tbody.innerHTML = myListings.map(item => `
        <tr class="hover:bg-gray-50 transition-colors">
          <td class="px-6 py-4"><div class="flex items-center gap-3"><div class="w-12 h-12 rounded-lg bg-gray-100 bg-cover bg-center border border-gray-200" style="background-image: url('${item.image}')"></div><div><p class="font-bold text-gray-800 line-clamp-1">${item.title}</p><p class="text-xs text-gray-500">${item.category}</p></div></div></td>
          <td class="px-6 py-4 font-bold text-gray-700">₹ ${item.price}</td>
          <td class="px-6 py-4"><span class="px-2 py-1 bg-green-100 text-green-700 rounded-full text-xs font-bold">Active</span></td>
          <td class="px-6 py-4 text-right">
            <div class="flex justify-end gap-2">
              <button onclick="editItem('${item.id}')" class="p-2 text-gray-400 hover:text-blue-500 hover:bg-white rounded-lg transition-all" title="Edit"><span class="material-symbols-outlined text-base">edit</span></button>
              <button onclick="viewItem('${item.id}')" class="p-2 text-gray-400 hover:text-green-500 hover:bg-white rounded-lg transition-all" title="View"><span class="material-symbols-outlined text-base">visibility</span></button>
              <button onclick="deleteItem('${item.id}')" class="p-2 text-gray-400 hover:text-red-500 hover:bg-white rounded-lg transition-all" title="Delete"><span class="material-symbols-outlined text-base">delete</span></button>
            </div>
          </td>
        </tr>
      `).join('');
    }

    // --- 3. ACTIONS ---
    window.editItem = (id) => { window.location.href = `Post Listing.html?id=${id}`; }
    window.viewItem = (id) => { window.location.href = `Listing Detail.html?id=${id}`; }
    
    window.deleteItem = (id) => {
      if(confirm("Delete this listing?")) {
        let listings = JSON.parse(localStorage.getItem('zzz_listings') || '[]');
        listings = listings.filter(l => l.id != id);
        localStorage.setItem('zzz_listings', JSON.stringify(listings));
        loadListings();
      }
    }

    // --- 4. NAVIGATION ---
    window.showSection = (id) => {
      ['dashboard', 'listings', 'payouts', 'settings'].forEach(sid => {
        document.getElementById(sid).classList.add('hidden');
        document.getElementById('nav-'+sid).classList.remove('active', 'bg-green-50', 'text-primary', 'border-r-4', 'border-primary');
      });
      document.getElementById(id).classList.remove('hidden');
      document.getElementById('nav-'+id).classList.add('active');
      document.getElementById('pageTitle').textContent = id.charAt(0).toUpperCase() + id.slice(1);
    }

    window.handleLogout = () => {
      localStorage.removeItem('zzz_user');
      window.location.href = 'Login Page.html';
    }

    // --- 5. STATS ---
    function updateStats(){
        const msgs = JSON.parse(localStorage.getItem('zzz_messages') || '[]');
        const unread = msgs.filter(m => m.toUserId === user?.id && !m.read).length;
        if(unread > 0) {
            document.getElementById('navMsgBadge').textContent = unread;
            document.getElementById('navMsgBadge').classList.remove('hidden');
            document.getElementById('dashUnreadText').textContent = `${unread} New Messages`;
        }
        
        // Chart
        new Chart(document.getElementById('sellerChart').getContext('2d'), {
            type: 'line',
            data: {
                labels: ['M','T','W','T','F','S','S'],
                datasets: [{label:'Views', data:[10,25,15,30,45,60,80], borderColor:'#019863', tension:0.4}]
            },
            options: { responsive:true, maintainAspectRatio:false }
        });
    }

    loadListings();
    if(user) updateStats();

  </script>
</body>
</html>