<!DOCTYPE html>
<html class="light" lang="en">
<head>
  <script>
  // --- AUTH CHECK (Optional for Search, but good for personalized header) ---
  (function() {
    const raw = localStorage.getItem('zzz_user');
    // We don't force login here, just check for UI customization
  })();
  </script>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ZipZapZoi - Search Results</title>

  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Spline+Sans:wght@400;500;600;700&display=swap" rel="stylesheet"/>
  <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet"/>

  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: { sans: ["Spline Sans", "sans-serif"] },
          colors: {
            "primary": "#019863",
            "secondary": "#4D96A9",
            "background-light": "#F7F9FC",
          },
          boxShadow: {
            "bouncy": "0 10px 20px -5px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05)",
          }
        }
      }
    }
  </script>
  <style>
    .material-symbols-outlined { font-variation-settings: 'FILL' 0, 'wght' 400, 'GRAD' 0, 'opsz' 24; }
    /* Range Slider Styling */
    input[type=range]::-webkit-slider-thumb {
      -webkit-appearance: none;
      height: 20px; width: 20px;
      border-radius: 50%;
      background: #019863;
      margin-top: -8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }
    input[type=range]::-webkit-slider-runnable-track {
      width: 100%; height: 4px;
      background: #e5e7eb;
      border-radius: 2px;
    }
  </style>
</head>
<body class="bg-background-light min-h-screen flex flex-col text-gray-800">

  <header class="bg-white border-b border-gray-200 sticky top-0 z-50 shadow-sm">
    <div class="container mx-auto px-6 h-16 flex items-center justify-between">
      <div class="flex items-center gap-3">
        <a href="classifieds.html" class="flex items-center gap-2 text-primary hover:text-green-700 transition-colors">
          <span class="material-symbols-outlined text-3xl">all_inclusive</span>
          <span class="font-bold text-xl tracking-tight hidden sm:block">ZipZapZoi</span>
        </a>
      </div>
      
      <div class="hidden md:flex flex-1 max-w-lg mx-8 relative">
        <input type="text" id="headerSearch" placeholder="Search for anything..." class="w-full bg-gray-100 border-none rounded-full py-2.5 pl-5 pr-12 focus:ring-2 focus:ring-primary/50 outline-none transition-all">
        <button onclick="performSearch()" class="absolute right-2 top-1.5 p-1 bg-white rounded-full text-primary shadow-sm hover:scale-110 transition-transform">
          <span class="material-symbols-outlined text-lg">search</span>
        </button>
      </div>

      <div class="flex items-center gap-6">
        <a href="classifieds.html" class="text-sm font-bold text-gray-500 hover:text-primary transition-colors">Browse</a>
        <div class="h-9 w-9 rounded-full bg-primary text-white flex items-center justify-center font-bold shadow-md border-2 border-white" id="navAvatar">G</div>
      </div>
    </div>
  </header>

  <main class="flex-grow container mx-auto px-6 py-8">
    
    <div class="md:hidden mb-6 relative">
       <input type="text" id="mobileSearch" placeholder="Search..." class="w-full bg-white border border-gray-200 rounded-lg py-3 px-4 shadow-sm focus:ring-2 focus:ring-primary/50 outline-none">
       <button onclick="performSearch('mobile')" class="absolute right-3 top-3 text-gray-400"><span class="material-symbols-outlined">search</span></button>
    </div>

    <div class="flex flex-col lg:flex-row gap-8">
      
      <aside class="w-full lg:w-64 flex-shrink-0 space-y-8">
        
        <button class="lg:hidden w-full flex items-center justify-between bg-white p-4 rounded-xl shadow-sm border border-gray-100 font-bold" onclick="document.getElementById('filterPanel').classList.toggle('hidden')">
          <span>Filters</span>
          <span class="material-symbols-outlined">filter_list</span>
        </button>

        <div id="filterPanel" class="hidden lg:block space-y-8">
          
          <div>
            <h3 class="font-bold text-lg mb-3 flex items-center gap-2"><span class="material-symbols-outlined text-secondary">category</span> Categories</h3>
            <div class="space-y-2 text-sm text-gray-600" id="categoryFilters">
              <label class="flex items-center gap-2 cursor-pointer hover:text-primary"><input type="checkbox" class="rounded text-primary focus:ring-primary filter-cat" value="Electronics"> Electronics</label>
              <label class="flex items-center gap-2 cursor-pointer hover:text-primary"><input type="checkbox" class="rounded text-primary focus:ring-primary filter-cat" value="Vehicles"> Vehicles</label>
              <label class="flex items-center gap-2 cursor-pointer hover:text-primary"><input type="checkbox" class="rounded text-primary focus:ring-primary filter-cat" value="Real Estate"> Real Estate</label>
              <label class="flex items-center gap-2 cursor-pointer hover:text-primary"><input type="checkbox" class="rounded text-primary focus:ring-primary filter-cat" value="Jobs"> Jobs</label>
              <label class="flex items-center gap-2 cursor-pointer hover:text-primary"><input type="checkbox" class="rounded text-primary focus:ring-primary filter-cat" value="Services"> Services</label>
            </div>
          </div>

          <div>
            <h3 class="font-bold text-lg mb-3 flex items-center gap-2"><span class="material-symbols-outlined text-green-600">payments</span> Price Range</h3>
            <input type="range" min="0" max="100000" step="1000" value="100000" class="w-full appearance-none bg-gray-200 h-1 rounded-full cursor-pointer mb-2" id="priceRange" oninput="updatePriceLabel(this.value)">
            <div class="flex justify-between text-xs font-bold text-gray-500">
              <span>₹0</span>
              <span id="priceLabel">₹1,00,000+</span>
            </div>
          </div>

          <div>
            <h3 class="font-bold text-lg mb-3 flex items-center gap-2"><span class="material-symbols-outlined text-blue-500">near_me</span> Distance</h3>
            <input type="range" min="1" max="100" step="1" value="100" class="w-full appearance-none bg-gray-200 h-1 rounded-full cursor-pointer mb-2" id="distanceRange" oninput="document.getElementById('distLabel').innerText = this.value + ' km'">
            <div class="flex justify-between text-xs font-bold text-gray-500">
              <span>1 km</span>
              <span id="distLabel">100 km</span>
            </div>
          </div>

          <div>
            <h3 class="font-bold text-lg mb-3 flex items-center gap-2"><span class="material-symbols-outlined text-purple-500">verified</span> Condition</h3>
            <div class="space-y-2 text-sm text-gray-600">
              <label class="flex items-center gap-2 cursor-pointer"><input type="checkbox" class="rounded text-primary focus:ring-primary filter-cond" value="New"> Brand New</label>
              <label class="flex items-center gap-2 cursor-pointer"><input type="checkbox" class="rounded text-primary focus:ring-primary filter-cond" value="Used"> Used / Pre-owned</label>
            </div>
          </div>

          <button onclick="applyFilters()" class="w-full bg-secondary hover:bg-cyan-700 text-white font-bold py-3 rounded-xl shadow-bouncy transition-transform active:scale-95">
            Apply Filters
          </button>
        </div>
      </aside>

      <div class="flex-1">
        
        <div class="flex justify-between items-center mb-6">
          <div>
            <h1 class="text-2xl font-bold text-gray-800">Search Results</h1>
            <p class="text-sm text-gray-500">Showing <span id="resultCount" class="font-bold">0</span> items for "<span id="queryText" class="italic text-primary">all</span>"</p>
          </div>
          <select id="sortBy" onchange="applyFilters()" class="bg-white border border-gray-200 text-sm rounded-lg px-3 py-2 focus:ring-primary focus:border-primary outline-none shadow-sm">
            <option value="newest">Newest First</option>
            <option value="price_low">Price: Low to High</option>
            <option value="price_high">Price: High to Low</option>
          </select>
        </div>

        <div id="resultsGrid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
          </div>

        <div id="emptyState" class="hidden flex-col items-center justify-center py-20 text-center bg-white rounded-3xl border border-dashed border-gray-200">
          <div class="w-24 h-24 bg-gray-50 rounded-full flex items-center justify-center mb-4 text-gray-300">
            <span class="material-symbols-outlined text-5xl">search_off</span>
          </div>
          <h3 class="text-xl font-bold text-gray-700">No results found</h3>
          <p class="text-gray-500 max-w-sm mt-2">Try adjusting your search or filters to find what you're looking for.</p>
          <button onclick="clearFilters()" class="mt-6 text-primary font-bold hover:underline">Clear all filters</button>
        </div>

      </div>
    </div>
  </main>

  <footer class="bg-white border-t border-gray-200 py-8 mt-auto">
    <div class="container mx-auto px-6 text-center text-sm text-gray-500">
      &copy; 2024 ZipZapZoi.
    </div>
  </footer>

  <script>
    // --- 1. SETUP ---
    const currentUser = JSON.parse(localStorage.getItem('zzz_user'));
    if(currentUser) document.getElementById('navAvatar').textContent = currentUser.name.charAt(0).toUpperCase();

    // --- 2. DATA SOURCE ---
    // Combine Mock Data + LocalStorage Listings
    const mockData = [
        { id: '101', title: "iPhone 14 Pro - Deep Purple", category: "Electronics", price: 65000, image: "https://images.unsplash.com/photo-1695048133142-1a20484d2569?auto=format&fit=crop&w=600&q=80", location: "Bengaluru", time: "2 hrs ago", condition: "Used" },
        { id: '102', title: "Royal Enfield Classic 350", category: "Vehicles", price: 145000, image: "https://images.unsplash.com/photo-1558981403-c5f9899a28bc?auto=format&fit=crop&w=600&q=80", location: "Mumbai", time: "5 hrs ago", condition: "Used" },
        { id: '103', title: "2 BHK Apartment", category: "Real Estate", price: 25000, image: "https://images.unsplash.com/photo-1522708323590-d24dbb6b0267?auto=format&fit=crop&w=600&q=80", location: "Hyderabad", time: "Yesterday", condition: "New" },
        { id: '104', title: "Graphic Designer Job", category: "Jobs", price: 45000, image: "https://images.unsplash.com/photo-1626785774573-4b799314346d?auto=format&fit=crop&w=600&q=80", location: "Remote", time: "1 day ago", condition: "New" },
        { id: '105', title: "Golden Retriever Puppy", category: "Pets", price: 15000, image: "https://images.unsplash.com/photo-1629740032638-58bfd37eb74e?auto=format&fit=crop&w=600&q=80", location: "Delhi", time: "3 days ago", condition: "New" },
        { id: '106', title: "Sony Headphones", category: "Electronics", price: 22000, image: "https://images.unsplash.com/photo-1618366712010-f4ae9c647dcb?auto=format&fit=crop&w=600&q=80", location: "Chennai", time: "1 week ago", condition: "New" }
    ];

    function getAllListings() {
        const userPosts = JSON.parse(localStorage.getItem('zzz_listings') || '[]');
        // Normalize user posts to match mock structure if needed
        const normalizedUserPosts = userPosts.map(p => ({
            ...p,
            price: Number(p.price) // Ensure price is number
        }));
        return [...normalizedUserPosts, ...mockData];
    }

    // --- 3. FILTER LOGIC ---
    function applyFilters() {
      const urlParams = new URLSearchParams(window.location.search);
      let query = urlParams.get('q') || '';
      
      // Override if typed in header
      const headerInput = document.getElementById('headerSearch').value;
      if(headerInput) query = headerInput;

      document.getElementById('queryText').textContent = query || "All Items";
      document.getElementById('headerSearch').value = query; // Sync inputs

      // Get Filter Values
      const selectedCats = Array.from(document.querySelectorAll('.filter-cat:checked')).map(cb => cb.value);
      const selectedConds = Array.from(document.querySelectorAll('.filter-cond:checked')).map(cb => cb.value);
      const maxPrice = Number(document.getElementById('priceRange').value);
      const sortVal = document.getElementById('sortBy').value;

      let results = getAllListings();

      // 1. Search Text
      if(query) {
        const q = query.toLowerCase();
        results = results.filter(item => 
           item.title.toLowerCase().includes(q) || 
           item.category.toLowerCase().includes(q) ||
           item.location.toLowerCase().includes(q)
        );
      }

      // 2. Categories
      if(selectedCats.length > 0) {
        results = results.filter(item => selectedCats.includes(item.category));
      }

      // 3. Condition
      if(selectedConds.length > 0) {
        results = results.filter(item => selectedConds.includes(item.condition));
      }

      // 4. Price
      results = results.filter(item => item.price <= maxPrice);

      // 5. Sorting
      if(sortVal === 'price_low') results.sort((a,b) => a.price - b.price);
      if(sortVal === 'price_high') results.sort((a,b) => b.price - a.price);
      // Newest is default (mock data assumed ordered or relies on time string which is hard to sort perfectly without timestamps)

      renderResults(results);
    }

    // --- 4. RENDER ---
    function renderResults(items) {
      const grid = document.getElementById('resultsGrid');
      const empty = document.getElementById('emptyState');
      
      document.getElementById('resultCount').textContent = items.length;

      if(items.length === 0) {
        grid.classList.add('hidden');
        empty.classList.remove('hidden');
        empty.classList.add('flex');
        return;
      }

      grid.classList.remove('hidden');
      empty.classList.add('hidden');
      empty.classList.remove('flex');

      grid.innerHTML = items.map(item => `
        <a href="Listing Detail.html?id=${item.id}" class="group block bg-white rounded-2xl shadow-sm hover:shadow-bouncy border border-gray-100 overflow-hidden transition-all duration-300 transform hover:-translate-y-1">
          <div class="relative h-48 bg-gray-100 overflow-hidden">
            <img src="${item.image || 'https://via.placeholder.com/300'}" alt="${item.title}" class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-500">
            <span class="absolute top-2 left-2 bg-black/60 text-white text-[10px] uppercase font-bold px-2 py-1 rounded backdrop-blur-sm tracking-wide">${item.category}</span>
            <button class="absolute top-2 right-2 p-2 bg-white/90 rounded-full text-gray-400 hover:text-red-500 shadow-sm transition-colors" title="Save">
              <span class="material-symbols-outlined text-lg leading-none">favorite</span>
            </button>
          </div>
          <div class="p-4">
            <div class="flex justify-between items-start">
               <h3 class="font-bold text-gray-800 line-clamp-2 leading-tight group-hover:text-primary transition-colors">${item.title}</h3>
            </div>
            <p class="text-xl font-bold text-primary mt-2">₹ ${item.price.toLocaleString()}</p>
            <div class="flex items-center justify-between mt-3 pt-3 border-t border-gray-100 text-xs text-gray-400">
              <div class="flex items-center gap-1"><span class="material-symbols-outlined text-sm">location_on</span> ${item.location}</div>
              <span>${item.time}</span>
            </div>
          </div>
        </a>
      `).join('');
    }

    // --- 5. HELPERS ---
    function updatePriceLabel(val) {
      document.getElementById('priceLabel').textContent = '₹ ' + Number(val).toLocaleString();
    }

    function performSearch(source) {
      const val = source === 'mobile' ? document.getElementById('mobileSearch').value : document.getElementById('headerSearch').value;
      const url = new URL(window.location);
      url.searchParams.set('q', val);
      window.history.pushState({}, '', url);
      applyFilters();
    }

    function clearFilters() {
      // Reset inputs
      document.querySelectorAll('input[type="checkbox"]').forEach(cb => cb.checked = false);
      document.getElementById('priceRange').value = 100000;
      updatePriceLabel(100000);
      document.getElementById('headerSearch').value = '';
      
      // Clear URL
      window.history.pushState({}, '', window.location.pathname);
      
      applyFilters();
    }

    // Handle Enter Key
    document.getElementById('headerSearch').addEventListener('keypress', (e) => { if(e.key === 'Enter') performSearch(); });
    document.getElementById('mobileSearch').addEventListener('keypress', (e) => { if(e.key === 'Enter') performSearch('mobile'); });

    // Initial Load
    applyFilters();

  </script>
</body>
</html>